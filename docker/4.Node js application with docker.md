# 도커를 이용한 간단한 Node.js 어플리케이션 만들기
- 순서 : Node.js 애플리케이션 만들기 -> 어떻게 Docker image로 생성할것인가?

## 1. Node.js 앱 만들기
- Node.js 소스파일은 리포지토리의 nodejs-test를 참고.

### Dockerfile 복습
- FROM : 이미지 생성 시 기반이 되는 이미지 레이어
- RUN : 도커 이미지가 생성되기 전에 수행할 쉘 명령어
- CMD : 컨테이너가 시작되었을 때 실행할 실행 파일 또는 쉘 스크립트. Dockerfile 내 1회만 사용 가능.

## 2. Docker Image 생성하기
- Node.js 프로젝트 루트 폴더에 Dockerfile 생성
- Dockerfile 내용
```
# Node 10버전이 베이스 이미지
FROM node:10

# (이미지 생성 전) Node 프로젝트에 대해 dependency를 모두 설치한다.
RUN npm install

# (컨테이너 생성 후) Node application 기동 명령어.
CMD ["node", "server.js"]
```
> 이렇게 하고 docker build . 을 입력하면, 파일이 없다고 에러가 발생한다.
> 왜 발생하는것일까?

## 3. 이미지 빌드 시 파일이 없다고 나오는 이유?
- Node 베이스 이미지를 가지고 임시 컨테이너를 생성한다.
- 베이스 이미지의 파일 스냅샷(home, bin, dev..)이 있다. 이것들은 임시컨테이너의 하드디스크에 들어간다.
- 이전에 작성한 Dockerfile의 RUN에서 npm install을 실행하는데, 이 때 package.json이 컨테이너 바깥에 있어서 에러가 발생한다.
- server.js 또한 컨테이너 안에 존재하지 않는다.
> 어떻게 해결해야 할까?

### Dockerfile - COPY
- COPY [복사할 파일 경로] [복사할 파일의 컨테이너 내부 위치]
- ex) COPY ./ ./ #경로의 모든 파일 전체를 COPY한다.
- ex) COPY ./package.json ./
> 해당 구문을 추가하고 build & run하면, 정상적으로 구동된다.
> 주의 : 전체 다 복사할 경우, node_modules폴더도 같이 넣게되면, 충돌 에러 발생.

