## 4. HTTP 메서드
- HTTP API
- HTTP 메서드 - GET, POST
- HTTP 메서드 - PUT, PATCH, DELETE
- HTTP 메서드의 속성

### 4-1. HTTP API 만들어보기
### 예시 - 요구사항
- 회원 정보 관리 API를 만들자.
1. 회원 목록 조회 /read-member-list
2. 회원 조회 /read-member-by-id
3. 회원 등록 /create-member
4. 회원 수정 /update-member
5. 회원 삭제 /delete-member
> 좋은 URI 설계일까?
> 가장 중요한 것은 리소스를 식별하는 것이다.

### API URI 를 어떻게 만들어야 할까?
- 리소스의 정의 : 회원을 등록하고, 수정하고 조회하는 것이 리소스가 아니라, 회원이 리소스다.
- 리소스를 어떻게 식별하는 것이 좋을까? : 회원이라는 리소스만 식별하면 된다. 그 리소스를 URI에 매핑한다. "회원"에 집중해라

### 예시 - API URI 설계
1. 회원 목록 조회 /members
2. 회원 조회 /members/{id}
3. 회원 등록 /members/{id}
4. 회원 수정 /members/{id}
5. 회원 삭제 /members/{id}
> 2~5까지는 어떻게 구분할 것이냐?
> 가장 중요한 것은 리소스를 식별하는 것이기 때문에, 리소스(명사)와 행위(동사, 메서드)를 분리해야 한다.
> 리소스 : 회원, 행위 : 조회, 등록, 삭제, 변경

### 4-2. HTTP 메서드 - GET, POST
#### 주요 메서드
- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록에 사용
- PUT: 리소스를 대체, 해당 리소스가 없으면 생성
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제
#### 기타 메서드
- HEAD : GET과 동일하지만, 메시지 부분을 제외하고, 상태 줄과 헤더만 변환
- OPTIONS : 대상 리소스에 대한 통신 가능 옵션(메서드)를 설명. (주로 CORS에서 사용)
- CONNECT: 대상 자원으로 식별되는 서버에 대한 터널을 설정
- TRACE: 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

### GET
- 리소스를 조회
- 서버에 전달하는 데이터는 query(쿼리 파라미터, 쿼리 스트링)을 통해서 전달
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많다.(get은 body에 뭘 잘 넣지 않음)
- ex) /members/100 으로 요청, 서버가 100번 아이디에 대한 데이터를 HTTP 응답 메시지에 담아서 회신한다.

### POST
- 요청 데이터를 처리하라
- "메시지 바디"를 통해 서버로 요청 데이터를 전달한다.
- 서버는 요청 데이터를 처리한다.
- 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용한다.
- ex) /members 에 message body에 데이터를 담아서 보내면, 서버에서는 데이터를 받아서 열어보고, 그에 따른 서버 로직을 처리한다.

### POST는 요청 데이터를 어떻게 처리한다는 뜻일까?
- 스펙: POST는 대상 리소스가 리소스의 고유한 의미 체계에 따라 요청에 포함된 표현을 처리하도록 요청한다.
- 예시
  - 데이터 블록을 데이터 처리 프로세스에 제공(HTML 폼에서 입력한 정보로 회원가입, 주문)
  - 게시판 글쓰기, 댓글 달기
  - 서버가 아직 식별하지 않은 새 리소스 생성(신규 주문 생성)
  - 기존 자원에 데이터 추가(한 문서 끝에 내용 추가)
> 리소스 URI에 POST 요청이 오면, 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야 한다.

### POST 요약
1. 새 리소스 생성
2. 요청 데이터 처리 : 단순히 값 변경이 아닌 프로세스 상태 변경일때도
> POST의 결과로 새로운 리소스가 생성되지 않을 수도 있다.
> ex) 결제 완료, 배달 시작 되는 경우: POST /orders{orderId}/start-delivery (컨트롤 URI) : 리소스만으로 설계가 되지 않는 URI가 있다.
3. 다른 메서드로 처리하기 애매한 경우
- JSON으로 조회 조건을 넘겨야 하는데, GET 메서드를 사용하기 어려운 경우..
> 조회할때는 GET이 유리하다. GET은 캐싱이 된다.

### 4-3. HTTP 메서드 - PUT, PATCH, DELETE
### PUT
- 리소스를 "완전히" 대체한다.(SQL MERGE같은 개념, 없으면 생성, 있으면 덮어쓰기.)
- PUT은 클라이언트가 리소스 위치를 알고 있다는 점이 POST와의 차이다.
> ex) PUT /members/100 (유저의 id를 알고있다.)
> 주의할 점 : 리소스를 완전히 대체한다는 의미.. 필드 하나만 업데이트 한다고, 필드 하나만 넣으면, 다른 필드가 삭제된다.

### PATCH
- 리소스를 "부분" 변경한다. PUT과 다르게, 필드 하나만 넣어도 필드 하나 업데이트만 된다.
> PATCH가 지원 안되는 서버가 있음.. 그런 경우에는 POST를 쓰면 된다.

### DELETE
- 리소스를 제거한다.
> ex) /members/100

### 4-4. HTTP 메서드의 속성
- 안전(Safe Methods)
- 멱등(Idempotent Methods)
- 캐시 가능(Cacheable Methods)

1. 안전
- 호출해도 리소스를 변경하지 않는다. (GET)
> 호출했을 때, 변경이 일어나지 않는 것! (많이 조회해서 생기는 외부적인 문제는 해당 없음.)

2. 멱등(Idempotent)
- 한 번 호출하든 100번 호출하든 결과가 똑같아야 한다.
- 멱등 메서드
  - GET : 동일 인풋으로 여러 번 조회해도 결과가 똑같다.
  - PUT : 결과를 완전 대체하기 때문에, 몇 번을 PUT해도 결과가 똑같다.
  - DELETE : 특정 리소스에 대한 삭제를 몇 번을 반복해도, 결과가 똑같다.
  > POST 메서드는 멱등이 아니다. ex) 결제가 두 번 발생했을 때.

### 왜 멱등이라는 개념이 필요한가?
- 자동 복구 매커니즘
> 서버가 TIMEOUT 등으로 정상 응답을 주지 않았을 때, 클라이언트가 동일 요청을 다시 해도 되는지에 대한 판단 근거
> 멱등이라면, 동일 요청을 몇 번이고 해도 되니, 부담없이 타임아웃되면 요청하면 된다.

### 재요청 중간에 다른 곳에서 리소스를 변경하는 경우는 멱등인가?
1. GET USER A, 나이 20
2. PUT USER A, 나이 30으로 변경
3. GET USER A => 나이 30이 되어있겠네? 그럼 멱등 아니네?
> 멱등은 외부 요인으로 리소스가 변경되는 것까지는 고려하지 않는다.

3. 캐시 가능(Cacheable)
- 응답 결과 리소스를 캐시해서 사용해도 되는가?
  - GET, HEAD, POST, PATCH 캐시 가능
- 실제로는 GET, HEAD 정도만 캐시한다.
> 캐시는 리소스에 대한 KEY가 있어야 하기 때문에, POST, PATCH는 메시지 바디까지 캐시 키로 고려해야 하기 때문에, 구현이 쉽지 않다.
